version: v1
kind: ServiceTemplate
variables: []

metadata:
  name: openai-notion-spec-to-implementation
  description: An agent that uses OpenAI's notion-spec-to-implementation skill and powered by gpt-5.2
  annotations:
    meshagent.service.id: meshagent.openai-notion-spec-to-implementation

agents:
  - name: openai-notion-spec-to-implementation
    annotations:
      meshagent.agent.type: ChatBot

container:
  image: us-central1-docker.pkg.dev/meshagent-life/meshagent-public/cli:{SERVER_VERSION}-esgz
  command: /bin/bash /var/start.sh
  storage:
    room:
    - path: /data
      read_only: false
    files:
    - path: /var/start.sh
      text: |
          #!/bin/bash
          
          set -e
          
          mkdir -p /data/skills
          if [ -d /skills ]; then
            cp -R -n /skills/* /data/skills/ 2>/dev/null || true
          fi
          
          exec /usr/bin/meshagent chatbot join \
            --model=gpt-5.2 \
            --require-storage \
            --require-web-search \
            --rule="you can use the storage tool to read skills not just the shell tool" \
            --rule="when a question could be served by a skill, read the skill and follow the pattern specified in the skill" \
            --rule="when using the storage tool to read files attached or referenced by the user, in the room, or output by the shell tool, the file path should be prefixed with /data." \
            --rule="when using the storage tool to read skills, the path should be prefixed with /data/skills (the folder where the skills are located)" \
            --storage-tool-local-path=/skills:/skills \
            --storage-tool-room-path=/:/data \
            --script-tool \
            -rr=agents/openai-notion-spec-to-implementation/rules.txt \
            --rule='You have customizable rules stored in agents/openai-notion-spec-to-implementation/rules.txt, you can use the read_file tool to read your rules. You can use the write_file tool to update the contents of the rules file or other text files. Use the read_file tool to read PDFs, examine images, or read files with a text/* mime type from attachments or files.' \
            --rule='You are a MeshAgent agent. MeshAgent is an agent operating system. You can find out more at www.meshagent.com and docs.meshagent.com' \
            --rule='You have some slash commands available' \
            --skill-dir /data/skills/notion-spec-to-implementation
    - path: /skills/notion-spec-to-implementation/SKILL.md
      text: |
          ---
          name: notion-spec-to-implementation
          description: Turn Notion specs into implementation plans, tasks, and progress tracking; use when implementing PRDs/feature specs and creating Notion plans + tasks from them.
          metadata:
            short-description: Turn Notion specs into implementation plans, tasks, and progress tracking
          ---
          
          # Spec to Implementation
          
          Convert a Notion spec into linked implementation plans, tasks, and ongoing status updates.
          
          ## Quick start
          1) Locate the spec with `Notion:notion-search`, then fetch it with `Notion:notion-fetch`.
          2) Parse requirements and ambiguities using `reference/spec-parsing.md`.
          3) Create a plan page with `Notion:notion-create-pages` (pick a template: quick vs. full).
          4) Find the task database, confirm schema, then create tasks with `Notion:notion-create-pages`.
          5) Link spec ↔ plan ↔ tasks; keep status current with `Notion:notion-update-page`.
          
          ## Workflow
          
          ### 0) If any MCP call fails because Notion MCP is not connected, pause and set it up:
          1. Add the Notion MCP:
             - `codex mcp add notion --url https://mcp.notion.com/mcp`
          2. Enable remote MCP client:
             - Set `[features].rmcp_client = true` in `config.toml` **or** run `codex --enable rmcp_client`
          3. Log in with OAuth:
             - `codex mcp login notion`
          
          After successful login, the user will have to restart codex. You should finish your answer and tell them so when they try again they can continue with Step 1.
          
          ### 1) Locate and read the spec
          - Search first (`Notion:notion-search`); if multiple hits, ask the user which to use.
          - Fetch the page (`Notion:notion-fetch`) and scan for requirements, acceptance criteria, constraints, and priorities. See `reference/spec-parsing.md` for extraction patterns.
          - Capture gaps/assumptions in a clarifications block before proceeding.
          
          ### 2) Choose plan depth
          - Simple change → use `reference/quick-implementation-plan.md`.
          - Multi-phase feature/migration → use `reference/standard-implementation-plan.md`.
          - Create the plan via `Notion:notion-create-pages`, include: overview, linked spec, requirements summary, phases, dependencies/risks, and success criteria. Link back to the spec.
          
          ### 3) Create tasks
          - Find the task database (`Notion:notion-search` → `Notion:notion-fetch` to confirm the data source and required properties). Patterns in `reference/task-creation.md`.
          - Size tasks to 1–2 days. Use `reference/task-creation-template.md` for content (context, objective, acceptance criteria, dependencies, resources).
          - Set properties: title/action verb, status, priority, relations to spec + plan, due date/story points/assignee if provided.
          - Create pages with `Notion:notion-create-pages` using the database’s `data_source_id`.
          
          ### 4) Link artifacts
          - Plan links to spec; tasks link to both plan and spec.
          - Optionally update the spec with a short “Implementation” section pointing to the plan and tasks using `Notion:notion-update-page`.
          
          ### 5) Track progress
          - Use the cadence in `reference/progress-tracking.md`.
          - Post updates with `reference/progress-update-template.md`; close phases with `reference/milestone-summary-template.md`.
          - Keep checklists and status fields in plan/tasks in sync; note blockers and decisions.
          
          ## References and examples
          - `reference/` — parsing patterns, plan/task templates, progress cadence (e.g., `spec-parsing.md`, `standard-implementation-plan.md`, `task-creation.md`, `progress-tracking.md`).
          - `examples/` — end-to-end walkthroughs (e.g., `ui-component.md`, `api-feature.md`, `database-migration.md`).
  environment:
    - name: OPENAI_MAX_TOKENS
      value: "8192"
    - name: MESHAGENT_TOKEN
      token:  
        identity: openai-notion-spec-to-implementation
        api:
          livekit: {}
          queues:
            list: true
          messaging:
            broadcast: true
            list: true
            send: true
          database:
            list_tables: true
          sync: {}
          storage: {}
          containers:
            logs: true
            use_containers: true
          developer:
            logs: true
          agents:
            register_agent: true
            register_public_toolkit: true
            register_private_toolkit: true
            call: true
            use_agents: true
            use_tools: true
            allowed_toolkits: null

