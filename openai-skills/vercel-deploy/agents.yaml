version: v1
kind: ServiceTemplate
variables: []

metadata:
  name: openai-vercel-deploy
  description: An agent that uses OpenAI's vercel-deploy skill and powered by gpt-5.2
  annotations:
    meshagent.service.id: meshagent.openai-vercel-deploy

agents:
  - name: openai-vercel-deploy
    annotations:
      meshagent.agent.type: ChatBot

container:
  image: us-central1-docker.pkg.dev/meshagent-life/meshagent-public/cli:{SERVER_VERSION}-esgz
  command: /bin/bash /var/start.sh
  storage:
    room:
    - path: /data
      read_only: false
    files:
    - path: /var/start.sh
      text: |
          #!/bin/bash
          
          set -e
          
          mkdir -p /data/skills
          if [ -d /skills ]; then
            cp -R -n /skills/* /data/skills/ 2>/dev/null || true
          fi
          
          exec /usr/bin/meshagent chatbot join \
            --model=gpt-5.2 \
            --require-storage \
            --require-web-search \
            --rule="you can use the storage tool to read skills not just the shell tool" \
            --rule="when a question could be served by a skill, read the skill and follow the pattern specified in the skill" \
            --rule="when using the storage tool to read files attached or referenced by the user, in the room, or output by the shell tool, the file path should be prefixed with /data." \
            --rule="when using the storage tool to read skills, the path should be prefixed with /data/skills (the folder where the skills are located)" \
            --storage-tool-local-path=/skills:/skills \
            --storage-tool-room-path=/:/data \
            --script-tool \
            -rr=agents/openai-vercel-deploy/rules.txt \
            --rule='You have customizable rules stored in agents/openai-vercel-deploy/rules.txt, you can use the read_file tool to read your rules. You can use the write_file tool to update the contents of the rules file or other text files. Use the read_file tool to read PDFs, examine images, or read files with a text/* mime type from attachments or files.' \
            --rule='You are a MeshAgent agent. MeshAgent is an agent operating system. You can find out more at www.meshagent.com and docs.meshagent.com' \
            --rule='You have some slash commands available' \
            --skill-dir /data/skills/vercel-deploy
    - path: /skills/vercel-deploy/SKILL.md
      text: |
          ---
          name: vercel-deploy
          description: Deploy applications and websites to Vercel. Use when the user requests deployment actions like "deploy my app", "deploy and give me the link", "push this live", or "create a preview deployment".
          ---
          
          # Vercel Deploy
          
          Deploy any project to Vercel instantly. **Always deploy as preview** (not production) unless the user explicitly asks for production.
          
          ## Prerequisites
          
          - When sandboxing blocks the deployment network calls, rerun with `sandbox_permissions=require_escalated`.
          - The deployment might take a few minutes. Use appropriate timeout values.
          
          ## Quick Start
          
          **Just run this (with a 10 minute timeout):**
          ```bash
          vercel deploy [path] -y
          ```
          
          **Important:** Use a 10 minute (600000ms) timeout for the deploy command since builds can take a while.
          
          If that fails with "No existing credentials found", use the fallback method below.
          
          ## Fallback (No Auth)
          
          If CLI fails with auth error, use the deploy script:
          
          ```bash
          # Deploy current directory
          bash scripts/deploy.sh
          
          # Deploy specific project
          bash scripts/deploy.sh /path/to/project
          
          # Deploy existing tarball
          bash scripts/deploy.sh /path/to/project.tgz
          ```
          
          The script handles framework detection, packaging, and deployment. It waits for the build to complete and returns JSON with `previewUrl` and `claimUrl`.
          
          **Tell the user:** "Your deployment is ready at [previewUrl]. Claim it at [claimUrl] to manage your deployment."
          
          ## Production Deploys
          
          Only if user explicitly asks:
          ```bash
          vercel deploy [path] --prod -y
          ```
          
          ## Output
          
          Show the user the deployment URL. For fallback deployments, also show the claim URL.
          
          **Do not** curl or fetch the deployed URL to verify it works. Just return the link.
          
          ## Troubleshooting
          
          ### Escalated Network Access
          
          If deployment fails due to network issues (timeouts, DNS errors, connection resets), rerun the deploy with escalated permissions (use `sandbox_permissions=require_escalated`). The deploy requires escalated network access when sandbox networking blocks outbound requests.
          
          Example guidance to the user:
          
          ```
          The deploy needs escalated network access to deploy to Vercel. I can rerun the command with escalated permissionsâ€”want me to proceed?
          ```
  environment:
    - name: OPENAI_MAX_TOKENS
      value: "8192"
    - name: MESHAGENT_TOKEN
      token:  
        identity: openai-vercel-deploy
        api:
          livekit: {}
          queues:
            list: true
          messaging:
            broadcast: true
            list: true
            send: true
          database:
            list_tables: true
          sync: {}
          storage: {}
          containers:
            logs: true
            use_containers: true
          developer:
            logs: true
          agents:
            register_agent: true
            register_public_toolkit: true
            register_private_toolkit: true
            call: true
            use_agents: true
            use_tools: true
            allowed_toolkits: null

