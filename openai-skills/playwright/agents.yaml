version: v1
kind: ServiceTemplate
variables: []

metadata:
  name: openai-playwright
  description: An agent that uses OpenAI's playwright skill and powered by gpt-5.2
  annotations:
    meshagent.service.id: meshagent.openai-playwright

agents:
  - name: openai-playwright
    annotations:
      meshagent.agent.type: ChatBot

container:
  image: us-central1-docker.pkg.dev/meshagent-life/meshagent-public/cli:{SERVER_VERSION}-esgz
  command: /bin/bash /var/start.sh
  storage:
    room:
    - path: /data
      read_only: false
    files:
    - path: /var/start.sh
      text: |
          #!/bin/bash
          
          set -e
          
          mkdir -p /data/skills
          if [ -d /skills ]; then
            cp -R -n /skills/* /data/skills/ 2>/dev/null || true
          fi
          
          exec /usr/bin/meshagent chatbot join \
            --model=gpt-5.2 \
            --require-storage \
            --require-web-search \
            --rule="you can use the storage tool to read skills not just the shell tool" \
            --rule="when a question could be served by a skill, read the skill and follow the pattern specified in the skill" \
            --rule="when using the storage tool to read files attached or referenced by the user, in the room, or output by the shell tool, the file path should be prefixed with /data." \
            --rule="when using the storage tool to read skills, the path should be prefixed with /data/skills (the folder where the skills are located)" \
            --storage-tool-local-path=/skills:/skills \
            --storage-tool-room-path=/:/data \
            --script-tool \
            -rr=agents/openai-playwright/rules.txt \
            --rule='You have customizable rules stored in agents/openai-playwright/rules.txt, you can use the read_file tool to read your rules. You can use the write_file tool to update the contents of the rules file or other text files. Use the read_file tool to read PDFs, examine images, or read files with a text/* mime type from attachments or files.' \
            --rule='You are a MeshAgent agent. MeshAgent is an agent operating system. You can find out more at www.meshagent.com and docs.meshagent.com' \
            --rule='You have some slash commands available' \
            --skill-dir /data/skills/playwright
    - path: /skills/playwright/SKILL.md
      text: |
          ---
          name: "playwright"
          description: "Use when the task requires automating a real browser from the terminal (navigation, form filling, snapshots, screenshots, data extraction, UI-flow debugging) via `playwright-cli` or the bundled wrapper script."
          ---
          
          
          # Playwright CLI Skill
          
          Drive a real browser from the terminal using `playwright-cli`. Prefer the bundled wrapper script so the CLI works even when it is not globally installed.
          Treat this skill as CLI-first automation. Do not pivot to `@playwright/test` unless the user explicitly asks for test files.
          
          ## Prerequisite check (required)
          
          Before proposing commands, check whether `npx` is available (the wrapper depends on it):
          
          ```bash
          command -v npx >/dev/null 2>&1
          ```
          
          If it is not available, pause and ask the user to install Node.js/npm (which provides `npx`). Provide these steps verbatim:
          
          ```bash
          # Verify Node/npm are installed
          node --version
          npm --version
          
          # If missing, install Node.js/npm, then:
          npm install -g @playwright/cli@latest
          playwright-cli --help
          ```
          
          Once `npx` is present, proceed with the wrapper script. A global install of `playwright-cli` is optional.
          
          ## Skill path (set once)
          
          ```bash
          export CODEX_HOME="${CODEX_HOME:-$HOME/.codex}"
          export PWCLI="$CODEX_HOME/skills/playwright/scripts/playwright_cli.sh"
          ```
          
          User-scoped skills install under `$CODEX_HOME/skills` (default: `~/.codex/skills`).
          
          ## Quick start
          
          Use the wrapper script:
          
          ```bash
          "$PWCLI" open https://playwright.dev --headed
          "$PWCLI" snapshot
          "$PWCLI" click e15
          "$PWCLI" type "Playwright"
          "$PWCLI" press Enter
          "$PWCLI" screenshot
          ```
          
          If the user prefers a global install, this is also valid:
          
          ```bash
          npm install -g @playwright/cli@latest
          playwright-cli --help
          ```
          
          ## Core workflow
          
          1. Open the page.
          2. Snapshot to get stable element refs.
          3. Interact using refs from the latest snapshot.
          4. Re-snapshot after navigation or significant DOM changes.
          5. Capture artifacts (screenshot, pdf, traces) when useful.
          
          Minimal loop:
          
          ```bash
          "$PWCLI" open https://example.com
          "$PWCLI" snapshot
          "$PWCLI" click e3
          "$PWCLI" snapshot
          ```
          
          ## When to snapshot again
          
          Snapshot again after:
          
          - navigation
          - clicking elements that change the UI substantially
          - opening/closing modals or menus
          - tab switches
          
          Refs can go stale. When a command fails due to a missing ref, snapshot again.
          
          ## Recommended patterns
          
          ### Form fill and submit
          
          ```bash
          "$PWCLI" open https://example.com/form
          "$PWCLI" snapshot
          "$PWCLI" fill e1 "user@example.com"
          "$PWCLI" fill e2 "password123"
          "$PWCLI" click e3
          "$PWCLI" snapshot
          ```
          
          ### Debug a UI flow with traces
          
          ```bash
          "$PWCLI" open https://example.com --headed
          "$PWCLI" tracing-start
          # ...interactions...
          "$PWCLI" tracing-stop
          ```
          
          ### Multi-tab work
          
          ```bash
          "$PWCLI" tab-new https://example.com
          "$PWCLI" tab-list
          "$PWCLI" tab-select 0
          "$PWCLI" snapshot
          ```
          
          ## Wrapper script
          
          The wrapper script uses `npx --package @playwright/cli playwright-cli` so the CLI can run without a global install:
          
          ```bash
          "$PWCLI" --help
          ```
          
          Prefer the wrapper unless the repository already standardizes on a global install.
          
          ## References
          
          Open only what you need:
          
          - CLI command reference: `references/cli.md`
          - Practical workflows and troubleshooting: `references/workflows.md`
          
          ## Guardrails
          
          - Always snapshot before referencing element ids like `e12`.
          - Re-snapshot when refs seem stale.
          - Prefer explicit commands over `eval` and `run-code` unless needed.
          - When you do not have a fresh snapshot, use placeholder refs like `eX` and say why; do not bypass refs with `run-code`.
          - Use `--headed` when a visual check will help.
          - When capturing artifacts in this repo, use `output/playwright/` and avoid introducing new top-level artifact folders.
          - Default to CLI commands and workflows, not Playwright test specs.
  environment:
    - name: OPENAI_MAX_TOKENS
      value: "8192"
    - name: MESHAGENT_TOKEN
      token:  
        identity: openai-playwright
        api:
          livekit: {}
          queues:
            list: true
          messaging:
            broadcast: true
            list: true
            send: true
          database:
            list_tables: true
          sync: {}
          storage: {}
          containers:
            logs: true
            use_containers: true
          developer:
            logs: true
          agents:
            register_agent: true
            register_public_toolkit: true
            register_private_toolkit: true
            call: true
            use_agents: true
            use_tools: true
            allowed_toolkits: null

