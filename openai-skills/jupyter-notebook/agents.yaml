version: v1
kind: ServiceTemplate
variables: []

metadata:
  name: openai-jupyter-notebook
  description: An agent that uses OpenAI's jupyter-notebook skill and powered by gpt-5.2
  annotations:
    meshagent.service.id: meshagent.openai-jupyter-notebook

agents:
  - name: openai-jupyter-notebook
    annotations:
      meshagent.agent.type: ChatBot

container:
  image: us-central1-docker.pkg.dev/meshagent-life/meshagent-public/cli:{SERVER_VERSION}-esgz
  command: /bin/bash /var/start.sh
  storage:
    room:
    - path: /data
      read_only: false
    files:
    - path: /var/start.sh
      text: |
          #!/bin/bash
          
          set -e
          
          mkdir -p /data/skills
          if [ -d /skills ]; then
            cp -R -n /skills/* /data/skills/ 2>/dev/null || true
          fi
          
          exec /usr/bin/meshagent chatbot join \
            --model=gpt-5.2 \
            --require-storage \
            --require-web-search \
            --rule="you can use the storage tool to read skills not just the shell tool" \
            --rule="when a question could be served by a skill, read the skill and follow the pattern specified in the skill" \
            --rule="when using the storage tool to read files attached or referenced by the user, in the room, or output by the shell tool, the file path should be prefixed with /data." \
            --rule="when using the storage tool to read skills, the path should be prefixed with /data/skills (the folder where the skills are located)" \
            --storage-tool-local-path=/skills:/skills \
            --storage-tool-room-path=/:/data \
            --script-tool \
            -rr=agents/openai-jupyter-notebook/rules.txt \
            --rule='You have customizable rules stored in agents/openai-jupyter-notebook/rules.txt, you can use the read_file tool to read your rules. You can use the write_file tool to update the contents of the rules file or other text files. Use the read_file tool to read PDFs, examine images, or read files with a text/* mime type from attachments or files.' \
            --rule='You are a MeshAgent agent. MeshAgent is an agent operating system. You can find out more at www.meshagent.com and docs.meshagent.com' \
            --rule='You have some slash commands available' \
            --skill-dir /data/skills/jupyter-notebook
    - path: /skills/jupyter-notebook/SKILL.md
      text: |
          ---
          name: "jupyter-notebook"
          description: "Use when the user asks to create, scaffold, or edit Jupyter notebooks (`.ipynb`) for experiments, explorations, or tutorials; prefer the bundled templates and run the helper script `new_notebook.py` to generate a clean starting notebook."
          ---
          
          
          # Jupyter Notebook Skill
          
          Create clean, reproducible Jupyter notebooks for two primary modes:
          
          - Experiments and exploratory analysis
          - Tutorials and teaching-oriented walkthroughs
          
          Prefer the bundled templates and the helper script for consistent structure and fewer JSON mistakes.
          
          ## When to use
          - Create a new `.ipynb` notebook from scratch.
          - Convert rough notes or scripts into a structured notebook.
          - Refactor an existing notebook to be more reproducible and skimmable.
          - Build experiments or tutorials that will be read or re-run by other people.
          
          ## Decision tree
          - If the request is exploratory, analytical, or hypothesis-driven, choose `experiment`.
          - If the request is instructional, step-by-step, or audience-specific, choose `tutorial`.
          - If editing an existing notebook, treat it as a refactor: preserve intent and improve structure.
          
          ## Skill path (set once)
          
          ```bash
          export CODEX_HOME="${CODEX_HOME:-$HOME/.codex}"
          export JUPYTER_NOTEBOOK_CLI="$CODEX_HOME/skills/jupyter-notebook/scripts/new_notebook.py"
          ```
          
          User-scoped skills install under `$CODEX_HOME/skills` (default: `~/.codex/skills`).
          
          ## Workflow
          1. Lock the intent.
          Identify the notebook kind: `experiment` or `tutorial`.
          Capture the objective, audience, and what "done" looks like.
          
          2. Scaffold from the template.
          Use the helper script to avoid hand-authoring raw notebook JSON.
          
          ```bash
          uv run --python 3.12 python "$JUPYTER_NOTEBOOK_CLI" \
            --kind experiment \
            --title "Compare prompt variants" \
            --out output/jupyter-notebook/compare-prompt-variants.ipynb
          ```
          
          ```bash
          uv run --python 3.12 python "$JUPYTER_NOTEBOOK_CLI" \
            --kind tutorial \
            --title "Intro to embeddings" \
            --out output/jupyter-notebook/intro-to-embeddings.ipynb
          ```
          
          3. Fill the notebook with small, runnable steps.
          Keep each code cell focused on one step.
          Add short markdown cells that explain the purpose and expected result.
          Avoid large, noisy outputs when a short summary works.
          
          4. Apply the right pattern.
          For experiments, follow `references/experiment-patterns.md`.
          For tutorials, follow `references/tutorial-patterns.md`.
          
          5. Edit safely when working with existing notebooks.
          Preserve the notebook structure; avoid reordering cells unless it improves the top-to-bottom story.
          Prefer targeted edits over full rewrites.
          If you must edit raw JSON, review `references/notebook-structure.md` first.
          
          6. Validate the result.
          Run the notebook top-to-bottom when the environment allows.
          If execution is not possible, say so explicitly and call out how to validate locally.
          Use the final pass checklist in `references/quality-checklist.md`.
          
          ## Templates and helper script
          - Templates live in `assets/experiment-template.ipynb` and `assets/tutorial-template.ipynb`.
          - The helper script loads a template, updates the title cell, and writes a notebook.
          
          Script path:
          - `$JUPYTER_NOTEBOOK_CLI` (installed default: `$CODEX_HOME/skills/jupyter-notebook/scripts/new_notebook.py`)
          
          ## Temp and output conventions
          - Use `tmp/jupyter-notebook/` for intermediate files; delete when done.
          - Write final artifacts under `output/jupyter-notebook/` when working in this repo.
          - Use stable, descriptive filenames (for example, `ablation-temperature.ipynb`).
          
          ## Dependencies (install only when needed)
          Prefer `uv` for dependency management.
          
          Optional Python packages for local notebook execution:
          
          ```bash
          uv pip install jupyterlab ipykernel
          ```
          
          The bundled scaffold script uses only the Python standard library and does not require extra dependencies.
          
          ## Environment
          No required environment variables.
          
          ## Reference map
          - `references/experiment-patterns.md`: experiment structure and heuristics.
          - `references/tutorial-patterns.md`: tutorial structure and teaching flow.
          - `references/notebook-structure.md`: notebook JSON shape and safe editing rules.
          - `references/quality-checklist.md`: final validation checklist.
  environment:
    - name: OPENAI_MAX_TOKENS
      value: "8192"
    - name: MESHAGENT_TOKEN
      token:  
        identity: openai-jupyter-notebook
        api:
          livekit: {}
          queues:
            list: true
          messaging:
            broadcast: true
            list: true
            send: true
          database:
            list_tables: true
          sync: {}
          storage: {}
          containers:
            logs: true
            use_containers: true
          developer:
            logs: true
          agents:
            register_agent: true
            register_public_toolkit: true
            register_private_toolkit: true
            call: true
            use_agents: true
            use_tools: true
            allowed_toolkits: null

